import Attribute from"../../../../../.kernel/js/html/attribute.min.js";import Dom from"../../../../../.kernel/js/html/dom.min.js";import Finder from"../../../../../.kernel/js/html/finder.min.js";import Rest from"../../../../../.kernel/js/communication/rest.min.js";import Location from"../../../../../.kernel/js/url/location.min.js";import Confirmbox from"../../../../lib/js/confirmbox.min.js";import Msgbox from"../../../../lib/js/msgbox.min.js";import Modal from"../../../../lib/js/modal.min.js";export default class Info{container=Finder.query("menu-conversation-info");retour=Finder.query("menu-conversation-info #retour");name=Finder.query("menu-conversation-info #name");date=Finder.query("menu-conversation-info #date");picture=Finder.query("menu-conversation-info #picture");bloque=Finder.query("menu-conversation-info #bloque");delete=Finder.query("menu-conversation-info #delete");report=Finder.query("menu-conversation-info #report");conversation_id=null;interlocutor_id=null;bloquer=!1;constructor(){}changeConv(e){this.conversation_id=e,Attribute.enable(this.delete),Attribute.enable(this.report),Attribute.enable(this.bloque),Rest.getFor(`/api/conversations/${e}/membres`,((e,t)=>{this.interlocutor_id=e._id,this.picture.src=null===e.photo?"/assets/img/default.png":"data:image/png;base64,"+e.photo,this.name.innerText=e.prenom+" "+e.nom}),null,null,null,null,null,null,0,!1),Rest.get(`/api/utilisateurs/${this.interlocutor_id}/bloque`,((e,t)=>{this.bloquer=e,this.bloque.innerText=e?"Débloquer cet utilisateur":"Bloquer cet utilisateur"}),null,null,null,null,0,!1),Rest.get(`/api/conversations/${e}`,((e,t)=>{this.date.innerText=`Depuis le ${e.cree_le}`}),null,null,null,null,0,!1)}repportUser(){Modal.create("Signalement",'\n            <textarea class="input" id="rapport" placeholder="Raison du signalement..."></textarea>',(()=>{let e=Finder.query("#rapport").value.trim();if(""===e)Msgbox.show("Attention","Vous devez entrer une raison.",Msgbox.IMG_WARN);else if(e.length<10)Msgbox.show("Attention","Vous devez entrer une raison de plus de 10 caractères.",Msgbox.IMG_WARN);else{let t=()=>Msgbox.show("Erreur","Une erreur est survenue.",Msgbox.IMG_ERROR);Rest.post(`/api/utilisateurs/${this.interlocutor_id}/rapport`,((e,r)=>{e?(Modal.close(),Msgbox.show("Signalement","Votre rapport a été envoyé.",Msgbox.IMG_OK)):t()}),(()=>{t()}),(()=>{t()}),(()=>{t()}),{raison:e},0,!0)}}))}blockUser(){let e=()=>Msgbox.show("Erreur","Une erreur est survenue.",Msgbox.IMG_ERROR);this.bloquer?Rest.delete(`/api/utilisateurs/${this.interlocutor_id}/bloque`,((t,r)=>{t?(this.bloquer=!1,this.bloque.innerText="Bloquer cet utilisateur",menu_conversation_message.checkBloque()):e()}),(()=>{e()}),(()=>{e()}),(()=>{e()}),{},0,!0):Rest.post(`/api/utilisateurs/${this.interlocutor_id}/bloque`,((t,r)=>{t?(this.bloquer=!0,this.bloque.innerText="Débloquer cet utilisateur",menu_conversation_message.checkBloque()):e()}),(()=>{e()}),(()=>{e()}),(()=>{e()}),{},0,!0)}comeBack(){menu_conversation_message.container.style.transform="translateX(0%)"}deleteConv(){null!==this.conversation_id&&Confirmbox.show("Suppression","Voulez-vous vraiment supprimer cette conversation ?",(()=>{let e=()=>Msgbox.show("Erreur","Une erreur est survenue.",Msgbox.IMG_ERROR);Rest.delete(`/api/conversations/${this.conversation_id}`,((t,r)=>{t?(this.conversation_id=null,this.name.innerText="",this.date.innerText="",Attribute.disable(this.delete),Attribute.disable(this.report),Attribute.disable(this.bloque),this.picture.src="/assets/img/default.png",menu_conversation_message.deleteConv(),menu_conversation_liste.deleteConv(),window.onMobile&&this.comeBack()):e()}),e,e,e,e,0,!1)}),(()=>{}),Confirmbox.IMG_WARN)}}
