import Attribute from"../../../../.kernel/js/html/attribute.min.js";import Dom from"../../../../.kernel/js/html/dom.min.js";import Finder from"../../../../.kernel/js/html/finder.min.js";import Rest from"../../../../.kernel/js/communication/rest.min.js";import Location from"../../../../.kernel/js/url/location.min.js";import Modal from"../../../lib/js/modal.min.js";import Msgbox from"../../../lib/js/msgbox.min.js";export default class Vehicule{container=Finder.query("menu-vehicule");liste=Finder.query("menu-vehicule #liste");constructor(){this.loadPlates()}deletePlate(e){let s=()=>Msgbox.show("Erreur","Impossible de supprimer la plaque.",Msgbox.IMG_ERROR);Rest.delete(`/api/plaques/${e}`,((e,l)=>{e?(Msgbox.show("Succès","La plaque a été supprimée."),menu_vehicule.loadPlates()):s()}),(()=>{s()}),(()=>{s()}),(()=>{s()}),{},0,!0)}loadPlates(){Rest.getFor("/api/plaques/moi",((e,s)=>{Dom.insert(`\n                    <div class="item">\n                        <span>${e._numero}</span>\n                        <button class="button-danger-border-small" onclick="menu_vehicule.deletePlate('${e._numero}')">Supprimer</button>\n                    </div>\n                `,this.liste)}),(()=>{Dom.clear(this.liste)}),(()=>{}),(()=>{Dom.clear(this.liste),Dom.insert("\n                    <p>Aucune plaque</p>\n                ",this.liste)}),(()=>{Dom.clear(this.liste),Dom.insert("\n                    <p>Impossible de charger les plaques</p>\n                ",this.liste)}),(()=>{}),{},0,!0)}addPlate(){Modal.create("Ajouter",'\n            <label class="label">NUMERO DE PLAQUE</label>\n            <input type="text" id="numero" class="input" placeholder="AA-123-BB">\n        ',this.submitPlate,null,"add")}submitPlate(){let e=Finder.query("modal #numero").value.trim();if(""===e)Msgbox.show("Attention","Veuillez entrer un numéro de plaque.",Msgbox.IMG_WARN);else if(/^[A-Z]{2}-[0-9]{3}-[A-Z]{2}$/.test(e)){let s=()=>Msgbox.show("Erreur","Impossible d'ajouter la plaque.",Msgbox.IMG_ERROR);Rest.post("/api/plaques",((e,s)=>{e?(Msgbox.show("Succès","La plaque a été ajoutée."),Modal.close(),menu_vehicule.loadPlates()):Msgbox.show("Erreur","Cette plaque existe déjà.",Msgbox.IMG_ERROR)}),(()=>{s()}),(()=>{s()}),(()=>{s()}),{numero:e},0,!0)}else Msgbox.show("Attention","Veuillez entrer un numéro de plaque valide.",Msgbox.IMG_WARN)}}
