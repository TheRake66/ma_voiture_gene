import Attribute from"../../../../.kernel/js/html/attribute.min.js";import Dom from"../../../../.kernel/js/html/dom.min.js";import Finder from"../../../../.kernel/js/html/finder.min.js";import Rest from"../../../../.kernel/js/communication/rest.min.js";import Location from"../../../../.kernel/js/url/location.min.js";import Modal from"../../../lib/js/modal.min.js";import Msgbox from"../../../lib/js/msgbox.min.js";export default class Parametre{container=Finder.query("menu-parametre");image=Finder.query("menu-parametre #image");titre=Finder.query("menu-parametre #titre");nom=Finder.query("menu-parametre #nom");prenom=Finder.query("menu-parametre #prenom");email=Finder.query("menu-parametre #email");constructor(){this.loadProfil()}loadProfil(){Rest.get("/api/utilisateurs/moi",((e,r)=>{this.image.src=null===e.photo?"/assets/img/default.png":"data:image/png;base64,"+e.photo,this.titre.innerText=e.nom+" "+e.prenom,this.nom.innerText=e.nom,this.prenom.innerText=e.prenom,this.email.innerText=e.email}),(()=>{}),(()=>{}),(()=>{}),{},0,!0)}modifyProfil(){Modal.create("Modifier",'\n                <div>\n                    <img id="image" src="/assets/img/default.png" alt="">\n                    <input type="file" id="file" accept="image/*">\n                    <div>\n                        <button id="changer" class="button">Changer</button>\n                        <button id="retirer" class="button-danger-border">Retirer</button>\n                    </div>\n                </div>\n\n                <label class="label" for="">NOM</label>\n                <input id="nom" class="input" type="text">\n    \n                <label class="label" for="">PRENOM</label>\n                <input id="prenom" class="input" type="text">\n    \n                <label class="label" for="">ADRESSE E-MAIL</label>\n                <input id="email" class="input" type="email">\n            ',this.submitProfil,null,"profil");let e=Finder.query("modal #image"),r=Finder.query("modal #nom"),t=Finder.query("modal #prenom"),n=Finder.query("modal #email"),i=Finder.query("modal #file"),o=Finder.query("modal #changer"),a=Finder.query("modal #retirer");e.src=this.image.src,r.value=this.nom.innerText,t.value=this.prenom.innerText,n.value=this.email.innerText,i.addEventListener("change",(()=>{let r=i.files[0],t=new FileReader;t.readAsDataURL(r),t.onload=()=>{e.src=t.result}})),o.onclick=()=>{i.click()},a.onclick=()=>{i.value="",e.src="/assets/img/default.png"}}submitProfil(){let e=Finder.query("modal #image"),r=Finder.query("modal #nom"),t=Finder.query("modal #prenom"),n=Finder.query("modal #email");Finder.query("modal #file"),Finder.query("modal #changer"),Finder.query("modal #retirer");""===r.value.trim()?(Msgbox.show("Attention","Veuillez entrer un nom.",Msgbox.IMG_WARN),r.focus()):""===t.value.trim()?(Msgbox.show("Attention","Veuillez entrer un prénom.",Msgbox.IMG_WARN),t.focus()):""===n.value.trim()?(Msgbox.show("Attention","Veuillez entrer une adresse e-mail.",Msgbox.IMG_WARN),n.focus()):Rest.patch("/api/utilisateurs/moi",((i,o)=>{i?(menu_parametre.image.src=e.src,menu_parametre.titre.innerText=r.value+" "+t.value,menu_parametre.nom.innerText=r.value,menu_parametre.prenom.innerText=t.value,menu_parametre.email.innerText=n.value,Msgbox.show("Succès","Vos informations ont été mises à jour.",Msgbox.IMG_OK),Modal.close()):Msgbox.show("Attention","Cet adresse e-mail est déjà utilisée.",Msgbox.IMG_WARN)}),(()=>{}),(()=>{}),(()=>{}),{nom:r.value.trim(),prenom:t.value.trim(),email:n.value.trim(),photo:"/assets/img/default.png"===e.src?null:e.src.split(",")[1]},0,!0)}modifyPass(){Modal.create("Changer",'\n                <label class="label" for="">ANCIEN MOT DE PASSE</label>\n                <input id="old" class="input" type="password">\n\n                <label class="label" for="">NOUVEAU MOT DE PASSE</label>\n                <input id="neww" class="input" type="password">\n\n                <label class="label" for="">CONFIRMER MOT DE PASSE</label>\n                <input id="confirm" class="input" type="password">\n            ',this.submitPass,null,"pass")}submitPass(){let e=Finder.query("modal #old").value.trim(),r=Finder.query("modal #neww").value.trim(),t=Finder.query("modal #confirm").value.trim();""===e?Msgbox.show("Attention","Veuillez entrer votre ancien mot de passe.",Msgbox.IMG_WARN):""===r?Msgbox.show("Attention","Veuillez entrer votre nouveau mot de passe.",Msgbox.IMG_WARN):""===t?Msgbox.show("Attention","Veuillez confirmer votre nouveau mot de passe.",Msgbox.IMG_WARN):r!==t?Msgbox.show("Attention","Les mots de passe ne correspondent pas.",Msgbox.IMG_WARN):Rest.patch("/api/utilisateurs/moi/motdepasse",((e,r)=>{e?(Msgbox.show("Succès","Votre mot de passe a été modifié.",Msgbox.IMG_OK),Modal.close()):Msgbox.show("Attention","Votre ancien mot de passe est incorrect.",Msgbox.IMG_WARN)}),(()=>{}),(()=>{}),(()=>{}),{ancien:e,nouveau:r},0,!0)}}
